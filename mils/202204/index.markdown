---
layout: mil
date: 1648738800
title: "CRUD 작업에서 의미 찾기: DDD"
tag: 삼정데이타서비스
permalink: /mils/202204
---

이번 달 역시 새로운 프로토타입을 만드는 업무를 진행하였다. 그런데 이번에는 정말 게시판의 확장 버전이었다. 다른 복잡한 알고리즘이나 모델 없이 글을 올리고 그에 대한 몇 가지 기능만 있으면 되는 간단한 수준이었다. 이런 방향으로 프로토타입 개발 방향이 잡히자 이번 작업을 통해 배울 수 있는 점이 있을지 바로 고민이 시작되었다. 단순한 sql 명령어를 실행하는 데이터베이스 레이어와 데이터베이스 테이블 구조과 비슷하게 생긴 API 요청 및 응답을 처리하는 API 서버 레이어. 기존 작업들과 아이템만 다를 뿐 별반 차이점이 없을 뿐더러 복사 붙여넣기만 하게 되지 싶었다.

그런데 대부분의 서비스 플랫폼을 생각했을 때 아이템이 다 다르고 부가적인 기능도 더러 있지만 결국에는 CRUD의 확장이라는 생각이 들었다. 반복적인 일이라고 생각할 수도 있지만 어떻게 하면 CRUD 자체를 잘할 수 있을지, 메소드와 구조체 단위에 집중할 것이 아니라 전체적인 구조와 패턴을 어떻게 잡으면 좋을지 고민해보아야 할 시간이라고 느꼈다.

이 때, 얼마 전에 읽었던 <만들면서 배우는 클린 아키텍처: 자바 코드로 구현하는 클린 웹 애플리케이션> 책에서 등장하는 DDD를 적용해보면 어떨까라는 생각이 떠올랐다. 책을 읽었어도 막상 적용해 볼 경험이 없었어서 글자 뿐인 지식이 될 까봐 염려하던 참이었다. 책의 내용은 자바로 되어 있었지만 결국에는 아키텍처이기 때문에 go로도 못할 이유가 없다고 생각했다.

다행히 마침 팀에서도 아키텍처 변화에 대한 얘기가 나와서 DDD 적용을 바로 시도해볼 수 있었다. 기존에는 데이터베이스 중심 설계를 하고 있어서 API 서버에서 데이터베이스를 직접 참조하는 구조에 중요한 로직들도 그냥 API 서버 패키지 안에서 모두 구현하고 있었다. 데이터베이스 레이어, API 서버 레이어를 정말 단순히 in, out 커넥터로 생각하여 모든 로직을 빼고 로직은 service 레이어에서 모두 처리할 수 있도록 하는 것이 이번 아키텍처 수정의 목표였다.

구현하면 할수록 기존 구조보다 훨씬 낫다는 느낌을 받을 수 있었다. API 서버 레이어는 단순히 API 요청을 받아 필수 필드의 존재 여부만 검증하여 service 레이어로 요청을 전달하고, 그 결과를 적절한 형태로 인코딩하여 응답으로 보낸다. 데이터베이스 레이어도 service 레이어로부터 요청을 받아 sql을 처리하는 역할에 지나지 않는다. 모든 레이어간의 통신은 service/model 패키지에 정의된 구조체를 이용한다. 해당 패키지 안에는 service 레이어에서 사용하는 외부 패키지들이 지켜야 하는 인터페이스도 정의되어 있어 다른 데이터베이스 벤더를 사용하게 될 때와 같은 상황에서 수정이 용이하다.

이런 아키텍처 수정 과정을 거치며 또 반복적인 업무가 될 것이라고 생각했던 CRUD 작업에서도 큰 흥미를 느낄 수 있었다. 물론 DDD가 다른 아키텍처들에 비해 무조건 낫다는 것은 아니지만 도메인 관점에서 응집성 있게 코드를 표현할 수 있는 좋은 방법 중에 하나라고 생각한다. 하루하루 더 나은 코드를 고민하는 성장하는 개발자가 되어야겠다.