---
layout: mil
date: 1622473200
title: Standalone to multiuser service
tag: 삼정데이타서비스
permalink: /mils/202106
---

어느 정도 go의 문법과 사용 사례를 익힌 뒤 처음으로 팀에서 참여하게 된 업무는 그 동안 standalone 모드에서 실행해 왔던 서비스를 multiuser 서비스로 확장시키는 작업이었다. Standalone 방식은 사용자마다 VM을 한 대씩 할당하여 전용 프로그램을 돌리는 것이었는데 사내 직원들을 대상으로 하는 서비스였기에 가능했다.

Standalone의 문제점은 두 가지가 있었다. 가장 큰 문제는 유지보수가 어렵다는 것이었다. 프로그램을 업데이트 하려고 할 때 모든 VM에 들어가서 새로 실행하고 빠져나오기를 반복해야 했다. 또한 로그 수집 과정도 복잡했으며, 새로 유저를 추가하려고 할 때도 VM 세팅부터 할 일이 많았다. 이런 유지보수에 들이는 시간은 발전적인 개발을 막는 요소가 되었다. 또한, 두 번째 문제는 컴퓨터에 대해 잘 모르는 사원들도 VM에 대해 잘 알아야 프로그램을 관리할 수 있다는 것이었다. 개인별 키가 VM 환경 변수에 직접 설정되어야 해서 사람들이 직접 터미널을 사용해야 했는데, 컴퓨터에 문외한인 사람들에게는 어려운 작업이었다.

이러한 문제점이 존재하였고, 또한 더 많은 사람들에게 우리가 만들고 있는 서비스를 제공하기 위해 standalone 모델에서 multiuser service 모델로 넘어가기로 결정하였다. 일반적으로 우리가 알고 있는 많은 웹 서비스 플랫폼과 같이 회원가입 및 로그인, 로그아웃 개념이 존재하고 중앙 서버에서 모든 것을 관리하는 방식이었다. 무조건적인 standalone에 대한 반대는 아니었다. Standalone의 장점은 서버가 각 사용자의 비밀키를 관리할 필요 없어 운영하는 입장에서 부담이 적다는 것이 있다. 그러나 결국에는 확장성 및 유지보수성을 고려하지 않을 수 없었기에 이와 같은 결정을 내린 것이었다.

내가 맡은 역할은 전체적인 프로그램의 구조를 만드는 것이었다. go에는 goroutine이라는 강력한 병렬 실행 도구가 있기 때문에 단순히 각 사용자마다 goroutine 하나씩 띄우는 것도 방법이 될 수 있지만, 결국에는 컴퓨팅 자원의 한계가 있기 때문에 중복되는 부분은 병합하고 필수적인 부분만 병렬 처리를 하는 방향이 맞았다. 또한, standalone 모드에서는 프로그램의 시작과 종료를 통해 프로그램의 실행 여부를 결정할 수 있었던 반면 이제부터는 하나의 죽지 않는 프로그램 위에서 동적으로 결정할 수 있어야 했다. 이러한 점들이 단순히 코드 수정이 아니라 코드의 구조 자체를 바꾸어야 하는 필요성을 설명한다.

내가 만들어 낸 새로운 프로그램의 구조는 VM을 추상화하여 클래스로 만들어버리고, 이를 관리하는 host 클래스도 하나 만들어 기존의 물리적인 구조를 소프트웨어로 옮겨 놓은 구조였다. VM 클래스 자체에 start, stop 메소드가 존재하여 프로그램의 시작과 종료를 따라하게 하였고, 각 VM 안에 원래 사용하던 로직이 들어가게 하였다.

지금 회고를 통해 되돌아보면 이러한 방식이 직관적이기는 하지만 최선의 방식이었다고는 생각하지 않는다. 코드를 만들 때 nested if else를 최대한 지양해야 한다는 중요한 코딩 스타일이 있다. 이것은 depth가 깊어질수록 일종의 공간지각력이 필요해지고 프로그래머들이 코드를 파악하는 것을 어렵게 하기 때문이라고 생각한다. 코드에서의 이러한 원리가 프로그램 구조에서도 동일하게 적용될 수 있다고 생각한다. 최대한 클래스 안의 클래스를 없앨 수 있었다면, 보기에 그리고 유지보수하기에 더 깔끔하지 않았을까 싶다.

비슷한 개념으로 데이터베이스 정규화가 있는 것 같다. 중복을 피하고 무결성을 지키는 데이터 관리를 위해서는 각 엔티티를 관계로 분리하는 정규화가 좋지만 성능 및 관리의 효율성 증가로 대표되는 반정규화의 장점도 무시할 수 없다. 모든 개발 스택에서 비슷한 개념이 등장한다는 것이 흥미롭다. 프로그램 구조를 설계하면서의 경험이 앞으로 나에게 어떤 도움을 줄 지 기대가 된다.