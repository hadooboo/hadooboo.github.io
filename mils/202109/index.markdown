---
layout: mil
date: 1630422000
title: 외부 API와 함께 작업하기
tag: 삼정데이타서비스
permalink: /mils/202109
---

대학교에 들어와서 1학년 1학기에 첫 전공 수업에서 배운 것은 abstraction였다. 교수님께서는 컴퓨터공학이 이렇게까지 발전할 수 있었던 것은 추상화 덕분이라고 말씀하셨다. 우리가 하위 계층에 대해 정확하게 알고 구현할 수 없을지라도 추상화를 통해 그 동작을 사용할 수 있으며 우리가 만든 것이 동시에 상위 계층에 추상화를 제공하곤 한다.

소프트웨어 개발을 하면서도 다양한 곳에서 추상화와 관련된 개념을 마주하게 되는 것 같다. 모듈을 인터페이스화해서 구현하는 것, 외부 API를 이용하는 것 등등이 있다. 그 동안의 개발 경험을 통해 추상화에는 병렬적이고 빠른 개발, 쉬운 플러그인과 같은 여러 강점이 존재함을 알게 되었다. 그러나 이번 달 회사 업무를 진행하며 큰 약점도 존재함을 새롭게 알게 되었다. 바로 스펙이 제대로 명시되어 있지 않은 경우에 발생하는 여러 문제들이다.

스펙이 제대로 명시되지 않았다는 것은 크게 보면 두 가지 케이스가 있다. 첫 번째로, 스펙이 불완전하게 명시되어 있지 않은 것, 그리고 스펙이 틀리게 명시되어 있는 것이다. 이번 달에 외부 API를 쓰면서 두 가지 케이스를 모두 경험하였다. 먼저 정의되어 있지 않은 에러 코드가 리턴되는 상황이 있었다. 우리 서비스 모델에서 에러 코드를 보고 다시 잠시 후 실행하면 해결될 것 같은 에러, 영구적으로 실패할 에러를 구분해서 로직을 짜 두었는데 문서에 나와 있지 않은 경우 네트워크 관련 실패라고 여기고 재시도하도록 했었다. 마치 HTTP 429 Too Many Requests 에러와 같은 경우이다. 그러나 정의되어 있지 않았던 에러는 HTTP 409 Conflict 에러였다. 서버에 일종의 로직이 숨겨져있었고 재시도로는 해결되지 않는 문제였다. 프로그램을 돌리던 중 해당 문제를 발견하여 hotfix로 대응해야 했다.

또 다른 문제는 웹소켓 연결로 받은 데이터의 논리 규칙이 틀린 경우였다. 예를 들어, count 변수에 2가 담겨서 오면 members 변수의 길이가 2로 올 것을 예상하고 로직을 만들었는데 데이터를 받아 보니 두 조건이 맞지 않았다. 이런 상황에서 당연히 segmentation fault 패닉이 발생하여 프로그램이 계속해서 죽었다가 재실행되었다. 이 부분도 실제 배포 후 발견하여 hotfix로 논리 규칙에 맞지 않는 메세지를 무시하도록 수정하였다.

이렇듯 외부 API는 강점에 못지 않게 우리가 제어할 수 없는 부분이 많고 정보의 격차가 존재한다는 단점을 알게 되었다. 매시업 과정에서 외부 API는 필수불가결한 요소이겠지만 마치 장난감처럼 충분히 많이 가지고 노는 과정을 선행함으로써 최대한의 정보를 가지고 다음 단계로 넘어가는 것이 최선이 아닐까 싶다. 회사에서 그럴 시간이 충분히 있을지는 모르겠지만 때로는 돌아가는 것이 더 빠르지 않을까?